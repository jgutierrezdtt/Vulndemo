<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DAST Demo - API Interface</title>
    <!-- Google Material Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap">
    <!-- Google Icon Font -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        .card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
            display: flex;
            align-items: center;
        }
        h1 i, h2 i {
            margin-right: 10px;
        }
        label {
            display: block;
            margin: 10px 0 5px;
        }
        input, button, textarea {
            padding: 8px;
            margin-bottom: 10px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        button i {
            margin-right: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            overflow-x: auto;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h1><i class="material-icons">security</i> DAST Demo - Interfaz de API</h1>
    
    <div class="card">
        <h2><i class="material-icons">health_and_safety</i> Estado del Servidor</h2>
        <button id="checkStatus"><i class="material-icons">check_circle</i> Verificar Estado</button>
        <div id="statusResult" class="result"></div>
    </div>

    <div class="card">
        <h2><i class="material-icons">swap_horiz</i> Reenviar Puerto</h2>
        <label for="portNumber">Número de Puerto:</label>
        <input type="text" id="portNumber" placeholder="Ej: 8080">
        <button id="forwardPort"><i class="material-icons">send</i> Reenviar Puerto</button>
        <div id="portResult" class="result"></div>
    </div>

    <div class="card">
        <h2><i class="material-icons">person_search</i> Consulta de Usuario (SQL)</h2>
        <label for="userId">ID de Usuario:</label>
        <input type="text" id="userId" placeholder="Ej: 1">
        <button id="getUser"><i class="material-icons">search</i> Buscar Usuario</button>
        <div id="userResult" class="result"></div>
    </div>

    <div class="card">
        <h2><i class="material-icons">login</i> Login de Usuario (SQL)</h2>
        <label for="username">Usuario:</label>
        <input type="text" id="username" placeholder="Nombre de usuario">
        <label for="password">Contraseña:</label>
        <input type="password" id="password" placeholder="Contraseña">
        <button id="loginUser"><i class="material-icons">key</i> Iniciar Sesión</button>
        <div id="loginResult" class="result"></div>
    </div>

    <div class="card">
        <h2><i class="material-icons">data_object</i> Consulta GraphQL</h2>
        <label for="graphqlId">ID de Usuario:</label>
        <input type="text" id="graphqlId" placeholder="Ej: 1">
        <button id="graphqlUser"><i class="material-icons">api</i> Consultar Usuario</button>
        <div id="graphqlResult" class="result"></div>
    </div>

    <div class="card">
        <h2><i class="material-icons">privacy_tip</i> Datos de Usuario (Incluye Datos Sensibles)</h2>
        <label for="userData">ID de Usuario:</label>
        <input type="text" id="userData" placeholder="Ej: 1">
        <button id="getUserData"><i class="material-icons">visibility</i> Obtener Datos</button>
        <div id="userDataResult" class="result"></div>
    </div>

    <div class="card">
        <h2><i class="material-icons">code</i> Ejecución de Código (EXTREMADAMENTE INSEGURO)</h2>
        <label for="jsQuery">Código JavaScript:</label>
        <textarea id="jsQuery" rows="4" style="width: 100%; margin-bottom: 10px;" 
          placeholder="Ejemplo: 'const files = require(\"fs\").readdirSync(\".\"); return files;'"></textarea>
        <button id="executeQuery"><i class="material-icons">play_arrow</i> Ejecutar Código</button>
        <div id="queryResult" class="result"></div>
    </div>

    <script>
        document.getElementById('checkStatus').addEventListener('click', async function() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                document.getElementById('statusResult').innerHTML = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('statusResult').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        });

        document.getElementById('forwardPort').addEventListener('click', async function() {
            try {
                const port = document.getElementById('portNumber').value;
                const response = await fetch(`/api/forward-port?port=${port}`);
                const data = await response.json();
                document.getElementById('portResult').innerHTML = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('portResult').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        });

        document.getElementById('getUser').addEventListener('click', async function() {
            try {
                const id = document.getElementById('userId').value;
                const response = await fetch(`/api/db/user?id=${id}`);
                const data = await response.json();
                document.getElementById('userResult').innerHTML = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('userResult').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        });

        document.getElementById('loginUser').addEventListener('click', async function() {
            try {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const response = await fetch('/api/db/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                const data = await response.json();
                document.getElementById('loginResult').innerHTML = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('loginResult').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        });

        document.getElementById('graphqlUser').addEventListener('click', async function() {
            try {
                const id = document.getElementById('graphqlId').value;
                const response = await fetch(`/api/db/graphql-user?id=${id}`);
                const data = await response.json();
                document.getElementById('graphqlResult').innerHTML = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('graphqlResult').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        });

        document.getElementById('getUserData').addEventListener('click', async function() {
            try {
                const id = document.getElementById('userData').value;
                const response = await fetch(`/api/db/user-data?id=${id}`);
                const data = await response.json();
                document.getElementById('userDataResult').innerHTML = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('userDataResult').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        });

        document.getElementById('executeQuery').addEventListener('click', async function() {
            try {
                const query = document.getElementById('jsQuery').value;
                const response = await fetch('/api/db/execute-query', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ query })
                });
                const data = await response.json();
                document.getElementById('queryResult').innerHTML = JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('queryResult').innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        });
    </script>
</body>
</html>